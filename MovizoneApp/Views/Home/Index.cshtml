@using MovizoneApp.Models
@{
    ViewData["Title"] = "Home - HotFlix";
    var featuredMovies = ViewBag.FeaturedMovies as List<Movie> ?? new List<Movie>();
    var topRatedMovies = ViewBag.TopRatedMovies as List<Movie> ?? new List<Movie>();
    var recentMovies = ViewBag.RecentMovies as List<Movie> ?? new List<Movie>();
    var allGenres = (ViewBag.Genres as List<string> ?? new List<string>()).Distinct().OrderBy(g => g).ToList();
}

<!-- Hero Carousel -->
<section class="home home--hero" style="padding: 0; margin-top: -2rem;">
    <div class="container-fluid px-0">
        <div id="heroCarousel" class="carousel slide carousel-fade" data-bs-ride="carousel" data-bs-interval="5000">
            <div class="carousel-inner">
                @{
                    var heroMovies = featuredMovies.Take(3).ToList();
                    var backgrounds = new[] { "slide__bg-1.jpg", "slide__bg-2.jpg", "slide__bg-3.jpg" };

                    for (int i = 0; i < Math.Max(heroMovies.Count, 3); i++)
                    {
                        var movie = i < heroMovies.Count ? heroMovies[i] : null;
                        var isActive = i == 0 ? "active" : "";
                        var bg = backgrounds[i % backgrounds.Length];
                        var ratingColor = movie != null && movie.Rating >= 8 ? "success" : movie != null && movie.Rating >= 6 ? "warning" : "danger";
                        var title = movie?.Title ?? (i == 0 ? "Savage Beauty" : i == 1 ? "From the Other Side" : "Endless Horizon");
                        var rating = movie?.Rating.ToString("0.0") ?? (i == 0 ? "9.8" : i == 1 ? "6.9" : "6.2");
                        var desc = movie?.Description ?? (i == 0 ? "A brilliant scientist discovers a way to harness the power of the ocean's currents to create a new, renewable energy source. But when her groundbreaking technology falls into the wrong hands, she must race against time to stop it from being used for evil." : i == 1 ? "In a world where magic is outlawed and hunted, a young witch must use her powers to fight back against the corrupt authorities who seek to destroy her kind." : "When a renowned archaeologist goes missing, his daughter sets out on a perilous journey to the heart of the Amazon rainforest to find him. Along the way, she discovers a hidden city and a dangerous conspiracy that threatens the very balance of power in the world.");
                <div class="carousel-item @isActive" style="height: 600px; position: relative;">
                    <img src="/img/bg/@bg" class="d-block w-100" alt="@title" style="height: 100%; object-fit: cover; filter: brightness(0.4);">
                    <div class="carousel-caption" style="bottom: 20%; left: 10%; right: 10%; text-align: left;">
                        <h2 class="display-4 fw-bold" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.8);">
                            @title <span class="badge bg-@ratingColor ms-3" style="font-size: 1.5rem;">@rating</span>
                        </h2>
                        <p class="lead mb-3" style="max-width: 700px; text-shadow: 1px 1px 4px rgba(0,0,0,0.8);">
                            @desc
                        </p>
                        <p class="mb-4">
                            @if (movie != null)
                            {
                                foreach (var genre in movie.Genre.Split(',').Take(2))
                                {
                                    <a href="#" class="badge bg-secondary text-decoration-none me-2" style="font-size: 1rem;">@genre.Trim()</a>
                                }
                            }
                            else
                            {
                                <a href="#" class="badge bg-secondary text-decoration-none me-2" style="font-size: 1rem;">Action</a>
                                <a href="#" class="badge bg-secondary text-decoration-none me-2" style="font-size: 1rem;">Drama</a>
                            }
                        </p>
                        <a href="@(movie != null ? Url.Action("Details", "Movie", new { id = movie.Id }) : "#")" class="btn btn-primary btn-lg px-5 py-3" style="box-shadow: 0 4px 12px rgba(255, 85, 165, 0.3);">
                            <i class="ti ti-player-play-filled me-2"></i> Watch Now
                        </a>
                    </div>
                </div>
                    }
                }
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
                <i class="ti ti-chevron-left" style="font-size: 2rem;"></i>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
                <i class="ti ti-chevron-right" style="font-size: 2rem;"></i>
            </button>
        </div>
    </div>
</section>

<!-- Filter & Catalog -->
<div style="background-color: #0f0f1e; padding-top: 3rem;">
    <!-- Filter -->
    <div class="container mb-4">
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <form asp-controller="Movie" asp-action="Catalog" method="get" class="row g-3 align-items-end">
                    <div class="col-6 col-md-3">
                        <label class="form-label text-white"><i class="ti ti-filter me-1"></i> Genre</label>
                        <select name="genre" class="form-select bg-dark text-white border-secondary">
                            <option value="">All genres</option>
                            @foreach (var genre in allGenres)
                            {
                                <option value="@genre">@genre</option>
                            }
                        </select>
                    </div>
                    <div class="col-6 col-md-2">
                        <label class="form-label text-white">Rating</label>
                        <select name="ratingFrom" class="form-select bg-dark text-white border-secondary">
                            <option value="">Any rating</option>
                            <option value="3">from 3.0</option>
                            <option value="5">from 5.0</option>
                            <option value="7">from 7.0</option>
                            <option value="9">from 9.0</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-2">
                        <label class="form-label text-white">Year</label>
                        <select name="yearFrom" class="form-select bg-dark text-white border-secondary">
                            <option value="">Any year</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2020">2020+</option>
                        </select>
                    </div>
                    <div class="col-6 col-md-2">
                        <label class="form-label text-white">Sort</label>
                        <select name="sort" class="form-select bg-dark text-white border-secondary">
                            <option value="newest">Newest</option>
                            <option value="rating">Rating</option>
                            <option value="title">Title</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-3">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="ti ti-search me-1"></i> Apply
                        </button>
                        <small class="text-muted d-block mt-2">Showing @featuredMovies.Count movies</small>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Catalog Grid -->
    <div class="container">
        <div class="row g-3 g-md-4 mb-5">
            @foreach (var movie in featuredMovies.Take(18))
            {
                var ratingClass = movie.Rating >= 8 ? "bg-success" : movie.Rating >= 6 ? "bg-warning" : "bg-danger";
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <div class="card bg-dark text-white h-100 border-0 position-relative" style="transition: all 0.3s; cursor: pointer;" onmouseover="this.style.transform='translateY(-10px)'; this.querySelector('.play-overlay').style.opacity='1'" onmouseout="this.style.transform='translateY(0)'; this.querySelector('.play-overlay').style.opacity='0'">
                    <div class="position-relative">
                        <img src="@movie.CoverImage" class="card-img-top" alt="@movie.Title" style="height: 280px; object-fit: cover;">
                        <a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.Id" class="play-overlay position-absolute top-50 start-50 translate-middle btn btn-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 50px; height: 50px; opacity: 0; transition: opacity 0.3s;">
                            <i class="ti ti-player-play-filled"></i>
                        </a>
                        <span class="position-absolute top-0 end-0 m-2 badge @ratingClass">@movie.Rating</span>
                        <button class="position-absolute top-0 start-0 m-2 btn btn-sm btn-dark border-0" style="opacity: 0.9;" type="button">
                            <i class="ti ti-bookmark"></i>
                        </button>
                    </div>
                    <div class="card-body p-2">
                        <h6 class="card-title mb-1" style="font-size: 0.85rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.Id" class="text-white text-decoration-none">
                                @movie.Title
                            </a>
                        </h6>
                        <small class="text-muted d-block" style="font-size: 0.75rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">@movie.Genre</small>
                    </div>
                </div>
            </div>
            }
        </div>

        <div class="row mb-5">
            <div class="col-12 text-center">
                <a asp-controller="Movie" asp-action="Catalog" class="btn btn-outline-primary btn-lg px-5">
                    <i class="ti ti-reload me-2"></i> Load More
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Expected Premiere -->
<section class="py-5" style="background-color: #0b0b17; border-top: 1px solid rgba(255, 255, 255, 0.1);">
    <div class="container">
        <div class="row mb-4">
            <div class="col-12 d-flex justify-content-between align-items-center">
                <h2 class="h3 mb-0"><i class="ti ti-star me-2"></i> Expected Premiere</h2>
                <a asp-controller="Movie" asp-action="Catalog" class="btn btn-link text-primary">View All <i class="ti ti-arrow-right"></i></a>
            </div>
        </div>
        <div class="row g-3 g-md-4">
            @foreach (var movie in recentMovies.Take(6))
            {
                var ratingClass = movie.Rating >= 8 ? "bg-success" : movie.Rating >= 6 ? "bg-warning" : "bg-danger";
            <div class="col-6 col-sm-4 col-md-3 col-lg-2">
                <div class="card bg-dark text-white h-100 border-0">
                    <div class="position-relative">
                        <img src="@movie.CoverImage" class="card-img-top" alt="@movie.Title" style="height: 260px; object-fit: cover;">
                        <a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.Id" class="position-absolute top-50 start-50 translate-middle btn btn-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;">
                            <i class="ti ti-player-play-filled"></i>
                        </a>
                        <span class="position-absolute top-0 end-0 m-2 badge @ratingClass">@movie.Rating</span>
                        <button class="position-absolute top-0 start-0 m-2 btn btn-sm btn-dark border-0" style="opacity: 0.9;" type="button">
                            <i class="ti ti-bookmark"></i>
                        </button>
                    </div>
                    <div class="card-body p-2">
                        <h6 class="card-title mb-1" style="font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            <a asp-controller="Movie" asp-action="Details" asp-route-id="@movie.Id" class="text-white text-decoration-none">
                                @movie.Title
                            </a>
                        </h6>
                        <small class="text-muted d-block" style="font-size: 0.7rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">@movie.Genre</small>
                    </div>
                </div>
            </div>
            }
        </div>
    </div>
</section>

<!-- Pricing Plans -->
<section class="py-5" style="background-color: #0f0f1e; border-top: 1px solid rgba(255, 255, 255, 0.1);">
    <div class="container">
        <div class="row mb-5">
            <div class="col-12 text-center">
                <h2 class="h2">Select Your Plan</h2>
            </div>
        </div>
        <div class="row g-4">
            <div class="col-12 col-md-6 col-lg-4">
                <div class="card bg-dark text-white h-100 border-secondary">
                    <div class="card-body text-center p-4">
                        <h3 class="h4 mb-3">Basic</h3>
                        <p class="display-5 fw-bold mb-4">Free</p>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2"><i class="ti ti-circle-check text-success me-2"></i> 7 days</li>
                            <li class="mb-2"><i class="ti ti-circle-check text-success me-2"></i> 720p Resolution</li>
                            <li class="mb-2 text-muted"><i class="ti ti-circle-minus me-2"></i> Limited Availability</li>
                            <li class="mb-2 text-muted"><i class="ti ti-circle-minus me-2"></i> Desktop Only</li>
                            <li class="mb-2 text-muted"><i class="ti ti-circle-minus me-2"></i> Limited Support</li>
                        </ul>
                        <a asp-controller="Auth" asp-action="SignUp" class="btn btn-outline-primary w-100 py-2">Register</a>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-12 col-lg-4">
                <div class="card text-white h-100 border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transform: scale(1.03); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);">
                    <div class="card-body text-center p-4">
                        <span class="badge bg-warning mb-2">Most Popular</span>
                        <h3 class="h4 mb-3">Premium</h3>
                        <p class="display-5 fw-bold mb-1">$34.99</p>
                        <p class="text-white-50 mb-4"><small>/ month</small></p>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> 1 Month</li>
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> Full HD</li>
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> Limited Availability</li>
                            <li class="mb-2 text-white-50"><i class="ti ti-circle-minus me-2"></i> TV & Desktop</li>
                            <li class="mb-2 text-white-50"><i class="ti ti-circle-minus me-2"></i> 24/7 Support</li>
                        </ul>
                        <button class="btn btn-light w-100 py-2" type="button">Choose Plan</button>
                    </div>
                </div>
            </div>

            <div class="col-12 col-md-6 col-lg-4">
                <div class="card text-white h-100 border-0" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <div class="card-body text-center p-4">
                        <h3 class="h4 mb-3">Cinematic</h3>
                        <p class="display-5 fw-bold mb-1">$49.99</p>
                        <p class="text-white-50 mb-4"><small>/ month</small></p>
                        <ul class="list-unstyled mb-4">
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> 2 Months</li>
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> Ultra HD</li>
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> Limited Availability</li>
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> Any Device</li>
                            <li class="mb-2"><i class="ti ti-circle-check me-2"></i> 24/7 Support</li>
                        </ul>
                        <button class="btn btn-light w-100 py-2" type="button">Choose Plan</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<style>
    .carousel-item {
        transition: transform 0.6s ease-in-out;
    }

    .carousel-caption {
        animation: fadeInUp 0.8s ease-in-out;
    }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .card {
        transition: all 0.3s ease;
    }

    .card:hover {
        box-shadow: 0 8px 24px rgba(255, 85, 165, 0.3);
    }

    .carousel-control-prev-icon,
    .carousel-control-next-icon {
        filter: invert(1);
    }
</style>
